ins = [3, 8, 1005, 8, 315, 1106, 0, 11, 0, 0, 0, 104, 1, 104, 0, 3, 8, 1002, 8, -1, 10, 101, 1, 10, 10, 4, 10, 1008, 8,
       0, 10, 4, 10, 101, 0, 8, 29, 2, 1006, 16, 10, 3, 8, 102, -1, 8, 10, 1001, 10, 1, 10, 4, 10, 1008, 8, 0, 10, 4,
       10, 102, 1, 8, 55, 3, 8, 102, -1, 8, 10, 1001, 10, 1, 10, 4, 10, 108, 1, 8, 10, 4, 10, 101, 0, 8, 76, 1, 101, 17,
       10, 1006, 0, 3, 2, 1005, 2, 10, 3, 8, 1002, 8, -1, 10, 1001, 10, 1, 10, 4, 10, 1008, 8, 1, 10, 4, 10, 101, 0, 8,
       110, 1, 107, 8, 10, 3, 8, 1002, 8, -1, 10, 1001, 10, 1, 10, 4, 10, 108, 0, 8, 10, 4, 10, 101, 0, 8, 135, 1, 108,
       19, 10, 2, 7, 14, 10, 2, 104, 10, 10, 3, 8, 1002, 8, -1, 10, 101, 1, 10, 10, 4, 10, 1008, 8, 1, 10, 4, 10, 101,
       0, 8, 170, 1, 1003, 12, 10, 1006, 0, 98, 1006, 0, 6, 1006, 0, 59, 3, 8, 1002, 8, -1, 10, 1001, 10, 1, 10, 4, 10,
       1008, 8, 0, 10, 4, 10, 102, 1, 8, 205, 1, 4, 18, 10, 1006, 0, 53, 1006, 0, 47, 1006, 0, 86, 3, 8, 1002, 8, -1,
       10, 101, 1, 10, 10, 4, 10, 108, 0, 8, 10, 4, 10, 1001, 8, 0, 239, 2, 9, 12, 10, 3, 8, 1002, 8, -1, 10, 1001, 10,
       1, 10, 4, 10, 1008, 8, 1, 10, 4, 10, 101, 0, 8, 266, 1006, 0, 8, 1, 109, 12, 10, 3, 8, 1002, 8, -1, 10, 1001, 10,
       1, 10, 4, 10, 108, 1, 8, 10, 4, 10, 1001, 8, 0, 294, 101, 1, 9, 9, 1007, 9, 1035, 10, 1005, 10, 15, 99, 109, 637,
       104, 0, 104, 1, 21102, 936995730328, 1, 1, 21102, 1, 332, 0, 1105, 1, 436, 21102, 1, 937109070740, 1, 21101, 0,
       343, 0, 1106, 0, 436, 3, 10, 104, 0, 104, 1, 3, 10, 104, 0, 104, 0, 3, 10, 104, 0, 104, 1, 3, 10, 104, 0, 104, 1,
       3, 10, 104, 0, 104, 0, 3, 10, 104, 0, 104, 1, 21102, 1, 179410308187, 1, 21101, 0, 390, 0, 1105, 1, 436, 21101,
       0, 29195603035, 1, 21102, 1, 401, 0, 1106, 0, 436, 3, 10, 104, 0, 104, 0, 3, 10, 104, 0, 104, 0, 21102,
       825016079204, 1, 1, 21102, 1, 424, 0, 1105, 1, 436, 21102, 1, 825544672020, 1, 21102, 435, 1, 0, 1106, 0, 436,
       99, 109, 2, 21202, -1, 1, 1, 21102, 1, 40, 2, 21102, 467, 1, 3, 21101, 0, 457, 0, 1105, 1, 500, 109, -2, 2106, 0,
       0, 0, 1, 0, 0, 1, 109, 2, 3, 10, 204, -1, 1001, 462, 463, 478, 4, 0, 1001, 462, 1, 462, 108, 4, 462, 10, 1006,
       10, 494, 1102, 0, 1, 462, 109, -2, 2106, 0, 0, 0, 109, 4, 1202, -1, 1, 499, 1207, -3, 0, 10, 1006, 10, 517,
       21102, 1, 0, -3, 22101, 0, -3, 1, 22101, 0, -2, 2, 21101, 1, 0, 3, 21101, 0, 536, 0, 1106, 0, 541, 109, -4, 2106,
       0, 0, 109, 5, 1207, -3, 1, 10, 1006, 10, 564, 2207, -4, -2, 10, 1006, 10, 564, 21202, -4, 1, -4, 1105, 1, 632,
       21202, -4, 1, 1, 21201, -3, -1, 2, 21202, -2, 2, 3, 21101, 583, 0, 0, 1106, 0, 541, 22102, 1, 1, -4, 21101, 0, 1,
       -1, 2207, -4, -2, 10, 1006, 10, 602, 21101, 0, 0, -1, 22202, -2, -1, -2, 2107, 0, -3, 10, 1006, 10, 624, 21202,
       -1, 1, 1, 21101, 624, 0, 0, 106, 0, 499, 21202, -2, -1, -2, 22201, -4, -2, -4, 109, -5, 2106, 0, 0]
input = 1

buffer_size = 1000
ins_buffer = [0] * buffer_size
ins = ins_buffer + ins + ins_buffer

index = buffer_size
rbase = 0

panels = {}
current_pos = [0, 0]  # robot coordinate
current_dir = 1  # 1-North | 2-East | 3-South | 4-West
output = [0, 0, 0]  # color, direction, output_index

min_x = 10000000
max_x = -10000000
min_y = 10000000
max_y = -10000000

while True:
    # INSTRUCTION FORMAT: ABCDE, Param1, [Param2, Param3]
    #   DE: two-digit opcode
    #    C: mode of 1st parameter
    #    B: mode of 2nd parameter
    #    A: mode of 3rd parameter
    # PARAMETER MODES:
    #    0: Position mode
    #    1: Immediate mode
    #    2: Relative mode
    param_mode = [0, 0, 0]

    # Calculate parameters mode
    ins_string = ''.join(reversed(str(ins[index])))
    if len(ins_string) >= 3:
        param_mode[0] = int(ins_string[2])
    if len(ins_string) >= 4:
        param_mode[1] = int(ins_string[3])
    if len(ins_string) >= 5:
        param_mode[2] = int(ins_string[4])

    # Calculate parameters index value
    if param_mode[0] == 1:
        param_1 = index + 1
    elif param_mode[0] == 2:
        param_1 = ins[index + 1] + rbase + buffer_size
    else:
        param_1 = ins[index + 1] + buffer_size
    if param_mode[1] == 1:
        param_2 = index + 2
    elif param_mode[1] == 2:
        param_2 = ins[index + 2] + rbase + buffer_size
    else:
        param_2 = ins[index + 2] + buffer_size
    if param_mode[2] == 2:
        param_3 = ins[index + 3] + rbase + buffer_size
    else:
        param_3 = ins[index + 3] + buffer_size

    # Execute based on opcode
    opcode = ins[index] % 100
    # print('opcode', opcode, ins[index])
    if opcode == 3:  # INPUT
        ins[param_1] = input
        index += 2
    elif opcode == 4:  # OUTPUT
        # print('Output:', ins[param_1])
        index += 2

        output[output[2]] = ins[param_1]
        output[2] = 1 if output[2] == 0 else 0

        if output[2] == 0:
            if min_x > current_pos[0]: min_x = current_pos[0]
            if max_x < current_pos[0]: max_x = current_pos[0]
            if min_y > current_pos[1]: min_y = current_pos[1]
            if max_y < current_pos[1]: max_y = current_pos[1]

            panels[tuple(current_pos)] = output[0]
            print('-' * 10)
            print('Paint:', 'Black' if output[0] == 0 else 'White')
            print('Turn:', 'Right' if output[1] == 1 else 'Left')
            print('Panels:', current_pos + [output[0]])
            print('before_dir:', current_dir)
            current_dir = current_dir + 1 if output[1] == 1 else current_dir - 1
            if current_dir > 4:
                current_dir = 1
            if current_dir < 1:
                current_dir = 4
            print('current_dir:', current_dir)
            print(current_pos)

            if current_dir == 1:
                current_pos[1] += 1
            elif current_dir == 2:
                current_pos[0] += 1
            elif current_dir == 3:
                current_pos[1] -= 1
            elif current_dir == 4:
                current_pos[0] -= 1

            input = panels[tuple(current_pos)] if tuple(current_pos) in panels else 0

    elif opcode == 9:  # ADJUST RELATIVE BASE
        rbase += ins[param_1]
        # print('R-base:', rbase)
        index += 2
    elif opcode == 1:  # ADD
        ins[param_3] = ins[param_1] + ins[param_2]
        index += 4
    elif opcode == 2:  # MULTIPLY
        ins[param_3] = ins[param_1] * ins[param_2]
        index += 4
    elif opcode == 5:  # JUMP IF TRUE
        if ins[param_1] != 0:
            index = ins[param_2] + buffer_size
        else:
            index += 3
    elif opcode == 6:  # JUMP IF FALSE
        if ins[param_1] == 0:
            index = ins[param_2] + buffer_size
        else:
            index += 3
    elif opcode == 7:  # LESS THAN
        ins[param_3] = 1 if ins[param_1] < ins[param_2] else 0
        index += 4
    elif opcode == 8:  # EQUALS
        ins[param_3] = 1 if ins[param_1] == ins[param_2] else 0
        index += 4
    elif opcode == 99:  # HALT!
        break
    # print(ins)

print(len(panels))
print(min_x, min_y, max_x, max_y)

out = [[0 for j in range(abs(min_x) + max_x + 1)] for i in range(abs(min_y) + max_y + 1)]
for key in panels:
    if panels[key] == 1:
        out[abs(min_y) + key[1]][abs(min_x) + key[0]] = 1

for i in reversed(range(len(out))):
    print(''.join(str(x) for x in out[i]).replace('1', '#').replace('0', ' '))
